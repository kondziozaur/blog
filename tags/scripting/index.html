<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <title>Tag: scripting | Random Notes</title>

  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <meta property="og:type" content="website">
<meta property="og:title" content="Random Notes">
<meta property="og:url" content="https://kondziozaur.github.io/blog/tags/scripting/index.html">
<meta property="og:site_name" content="Random Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Random Notes">
  
    <link rel="alternative" href="/atom.xml" title="Random Notes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
    
  <meta content="{{ title }}" name="description">
  <meta content="{{ title }}" name="keywords">
  <meta content="{{ title }}" name="author">

  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|PT+Sans+Narrow|Source+Sans+Pro:200,300,400,600,700,900&amp;subset=all" rel="stylesheet" type="text/css">

  <!-- Global styles START -->   
  <link rel="stylesheet" href="/blog/metronic/assets/plugins/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/blog/metronic/assets/plugins/bootstrap/css/bootstrap.min.css">
  <!-- Global styles END --> 
   
  <!-- Page level plugin styles START -->
  <link rel="stylesheet" href="/blog/metronic/assets/pages/css/animate.css">
  <link rel="stylesheet" href="/blog/metronic/assets/plugins/owl.carousel/assets/owl.carousel.css">
  <!-- Page level plugin styles END -->

  <!-- Theme styles START -->
  <link rel="stylesheet" href="/blog/metronic/assets/pages/css/components.css">
  <link rel="stylesheet" href="/blog/metronic/assets/pages/css/slider.css">
  <link rel="stylesheet" href="/blog/metronic/assets/corporate/css/style.css">
  <link rel="stylesheet" href="/blog/metronic/assets/pages/css/portfolio.css">
  <link rel="stylesheet" href="/blog/metronic/assets/corporate/css/style-responsive.css">
  <link rel="stylesheet" href="/blog/metronic/assets/corporate/css/themes/red.css">
  <link rel="stylesheet" href="/blog/css/theme-styles.css">
  <!-- Theme styles END -->
</head>

<body class="corporate">
  <!-- BEGIN TOP BAR -->
<div class="pre-header">
  <div class="container">
    <div class="row">
      <!-- BEGIN TOP BAR LEFT PART -->
      <div class="col-md-6 col-sm-6 col-xs-9 additional-shop-info">
	<ul class="list-unstyled list-inline">
	  <li><i class="fa fa-phone"></i><span>716-472-4484</span></li>
	  <li><i class="fa fa-envelope-o"></i><span>ptsteadman@gmail.com</span></li>
	</ul>
      </div>
      <!-- END TOP BAR LEFT PART -->
      <!-- BEGIN TOP BAR MENU -->
      <div class="col-md-6 col-sm-6 col-xs-3 additional-nav">
	<ul class="list-unstyled list-inline pull-right">
	  <li><a href="/login">Log In</a></li>
	</ul>
      </div>
      <!-- END TOP BAR MENU -->
    </div>
  </div>        
</div>
<!-- END TOP BAR -->
<!-- BEGIN HEADER -->
<div class="header">
  <div class="container">
    <!--<a class="site-logo" href="/blog/" id="logo">Random Notes</a>-->

    <a class="site-logo" href="/">
      <img src="/blog/metronic/assets/corporate/img/logos/logo-corp-red.png" alt="Metronic FrontEnd">
    </a>

    <a href="javascript:void(0);" class="mobi-toggler"><i class="fa fa-bars"></i></a>

    <!-- BEGIN NAVIGATION -->
    <div class="header-navigation pull-right font-transform-inherit">
      <ul>
	
	<li class="">
	  <a  href="/blog/">Home</a>
	</li>
	
	<li class="">
	  <a  href="/blog/projects/">Projects</a>
	</li>
	
	<li class="">
	  <a  href="/blog/archives/">Blog</a>
	</li>
	
	<li class="">
	  <a  href="/blog/contact/">Contact</a>
	</li>
	
	<li class="">
	  <a  href="/blog/about/">About</a>
	</li>
	
	<!-- BEGIN TOP SEARCH -->
	<li class="menu-search">
	  <span class="sep"></span>
	  <i class="fa fa-search search-btn"></i>
	  <div class="search-box">
	    <form action="#">
	      <div class="input-group">
		<input type="text" placeholder="Search" class="form-control st-default-search-input">
		<span class="input-group-btn">
		  <button class="btn btn-primary" type="submit">Search</button>
		</span>
	      </div>
	    </form>
	  </div> 
	</li>
	<!-- END TOP SEARCH -->
      </ul>
    </div>
    <!-- END NAVIGATION -->
  </div>
</div>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/blog">Blog</a></li>
    <li class="active">Tagged: scripting</li>
  </ul>
<section id="main">
  <h1>Tagged: scripting</h1>
  <div class="row">

<div class="col-xs-12 blog-posts">


  <section class="archives-wrap">
    <div class="archives">
      
	<div class="row">
  <div class="col-md-4 col-sm-4">
    
  </div>
  
    <div class="col-xs-12">
  
    
    <h2 itemprop="name">
      <a class="archive-article-title" href="/blog/2016/09/24/2016-09-24-processing-ldap-users-using-shell/">Delete LDAP users that do not match an attribute, using whitelist</a>
    </h2>


    <ul class="blog-info">
      <li>
      	<i class="fa fa-calendar"></i> 
        <time datetime="2016-09-24T06:15:47.000Z" itemprop="datePublished">2016/09/24</time>

      </li>
      <li><i class="fa fa-comments"></i>
        <a href="https://kondziozaur.github.io/blog/blog/2016/09/24/2016-09-24-processing-ldap-users-using-shell/#disqus_thread" class="article-comment-link">Comments</a>
      </li>
      <li>
	<i class="fa fa-tags"></i>
	
  
    <a href="/blog/tags/Apache-Directory-Studio/" title="Apache Directory Studio">Apache Directory Studio</a>,
  
    <a href="/blog/tags/csv/" title="csv">csv</a>,
  
    <a href="/blog/tags/ldap/" title="ldap">ldap</a>,
  
    <a href="/blog/tags/linux/" title="linux">linux</a>,
  
    <a href="/blog/tags/shell/" title="shell">shell</a>,
  
    <a href="/blog/tags/shell-is-my-spreadsheet/" title="shell is my spreadsheet">shell is my spreadsheet</a>,
  
    <a href="/blog/tags/text-files/" title="text files">text files</a>,
  
    <a href="/blog/tags/scripting/" title="scripting">scripting</a>,
  
    <a href="/blog/tags/identity-management/" title="identity management">identity management</a>
  


      </li>
    </ul>
    <div class="blog-item">
      
	<p>So you have a messy LDAP directory with tens of thousands users registered that don’t really belong to it. Each user has an <em>accountId</em>, and now you got your <em>whitelist of accountIds</em> that need to stay, and all other users should be removed from the directory.</p>
<p>There is no direct ldapdelete way of doing it - you need to provide <em>dn</em>, not an attribute that has no match in your whitelist. So, how to proceed? Probably tens of solutions possible, but for my requirements this was the easiest:</p>
<ol>
<li>Export all users as csv file using any tool that can do it, e.g. <a href="http://directory.apache.org/studio/" target="_blank" rel="external">Apache Directory Studio</a> (list all attributes you want to fetch, for sure provide the accountId). Save in <code>people-ldap-export.csv</code></li>
<li>Have the whitelist of <em>accountIds</em> as another csv file, <code>accountWhiteList.csv</code></li>
<li><p>Create a whitelist csv file with your users:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xargs -I &#123;&#125; grep &quot;\&quot;&#123;&#125;\&quot;&quot; people-ldap-export.csv &lt; accountWhiteList.csv &gt; people-ldap-export-whitelist.csv</div></pre></td></tr></table></figure>
</li>
<li><p>Now that you have full list and whitelist, create a blacklist:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">diff people-ldap-export.csv people-ldap-export-whitelist.csv | grep &apos;&lt;&apos; | cut -c3- &gt; people-ldap-export-blacklist.csv</div></pre></td></tr></table></figure>
</li>
<li><p>And create a file for ldapdelete that has only list of blacklisted <em>dn</em>. (in my csv the dn was first field in quotes, hence I extract first string between <code>&quot;</code> characters.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed &apos;s/^&quot;\([^&quot;]*\).*/\1/&apos; &lt; people-ldap-export-blacklist.csv &gt; people-ldap-export-blacklist-dn.csv</div></pre></td></tr></table></figure>
</li>
<li><p>Now just delete the blacklisted dns:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ldapdelete -h myhost.company.com -D &quot;cn=Directory Manager&quot; -w password -p 389  &lt; people-ldap-export-blacklist-dn.csv</div></pre></td></tr></table></figure>
</li>
</ol>
<p>One importtant thing to consider: New user with new accountId can be created in your repo anytime, and you want to make sure he won’t be listed in the blacklist. Just make your user export first, then make sure that your accountId whitelist is up to date (was generated after you made the export). This way new users won’t be processed by the above steps at all, and won’t get deleted.</p>
<p>Refs:</p>
<ul>
<li><a href="http://unix.stackexchange.com/questions/110645/select-lines-from-text-file-which-have-ids-listed-in-another-file" target="_blank" rel="external">http://unix.stackexchange.com/questions/110645/select-lines-from-text-file-which-have-ids-listed-in-another-file</a></li>
<li><a href="http://www.grymoire.com/Unix/Sed.html" target="_blank" rel="external">http://www.grymoire.com/Unix/Sed.html</a></li>
</ul>

      
    </div>
    <br>
    <br>
    <a href="https://kondziozaur.github.io/blog/blog/2016/09/24/2016-09-24-processing-ldap-users-using-shell/" class="more">Read more <i class="icon-angle-right"></i></a>
  </div>
</div>
<hr class="blog-post-sep">

      
    </div>
    
      <div id="page-nav" class="pagination">
	<span class="page-number current">1</span>
      </div>
    
  </section>

</div>

</div>

</section>
</div>


    <!-- BEGIN PRE-FOOTER -->
    <div class="pre-footer">
      <div class="container">
        <div class="row">
          <!-- BEGIN BOTTOM ABOUT BLOCK -->
          <div class="col-md-4 col-sm-6 pre-footer-col">
            <h2>About Us</h2>
            <p>Computer Lab is a software development and marketing company based in Brooklyn, New York. <br><br> Computer Lab was founded in 2015, and is focused on so on and so forth.</p>
          </div>
          <!-- END BOTTOM ABOUT BLOCK -->

          <!-- BEGIN BOTTOM CONTACTS -->
          <div class="col-md-4 col-sm-6 pre-footer-col">
            <h2>Contact</h2>
            <address class="margin-bottom-40">
              140 Metropolitan Avenue<br>
              5th Floor<br>
              Brooklyn, NY 11249<br>
              Phone: 716-472-4484<br>
              Email: <a href="mailto:ptsteadman@gmail.com">ptsteadman@gmail.com</a><br>
            </address>
          </div>
          <!-- END BOTTOM CONTACTS -->

	
          <!-- BEGIN TWITTER BLOCK --> 
          <div class="col-md-4 col-sm-6 pre-footer-col">

	  <a data-tweet-limit="1" class="twitter-timeline"
	  href="https://twitter.com/computerlab_"
	  data-widget-id="678830341331820544">Tweets by @computerlab_</a>

	  <script>!function(d,s,id){var
	  js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

          </div>
          <!-- END TWITTER BLOCK -->
	
        </div>
      </div>
    </div>
    <!-- END PRE-FOOTER -->

    <!-- BEGIN FOOTER -->
    <div class="footer">
      <div class="container">
        <div class="row">
          <!-- BEGIN COPYRIGHT -->
          <div class="col-md-6 col-sm-6 padding-top-10">
                  &copy; 2016 Random Notes<br>
 <a href="javascript:;">Privacy Policy</a> | <a href="javascript:;">Terms of Service</a>
          </div>
          <!-- END COPYRIGHT -->
	  <!-- BEGIN SOCIAL -->
<div class="col-md-6 col-sm-6">
  <ul class="social-footer list-unstyled list-inline pull-right">
    
      <li><a href="https://github.com/ptsteadman"><i class="fa fa-github"></i></a></li>
    
      <li><a href="https://twitter.com/ptsteadman"><i class="fa fa-twitter"></i></a></li>
    
      <li><a href="https://www.facebook.com/ptsteadman"><i class="fa fa-facebook"></i></a></li>
    
      <li><a href="/blog/atom.xml"><i class="fa fa-rss"></i></a></li>
    
      <li><a href="https://linkedin.com/in/ptsteadman"><i class="fa fa-linkedin"></i></a></li>
    
      <li><a href="http://stackoverflow.com/users/2480493/patrick-steadman"><i class="fa fa-stackoverflow"></i></a></li>
    
  </ul>  
</div>
<!-- END SOCIAL -->

        </div>
      </div>
    </div>
    <!-- END FOOTER -->

  <!-- BEGIN CORE PLUGINS (REQUIRED FOR ALL PAGES) -->
<!--[if lt IE 9]>
<script src="/blog/metronic/assets/plugins/respond.min.js"></script>
<![endif]--> 
<script src="/blog/metronic/assets/plugins/jquery.min.js"></script>
<script src="/blog/metronic/assets/plugins/jquery-migrate.min.js"></script>
<script src="/blog/metronic/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="/blog/metronic/assets/corporate/scripts/back-to-top.js"></script>
<script src="/blog/metronic/assets/plugins/owl.carousel/owl.carousel.min.js"></script>
<script src="/blog/metronic/assets/corporate/scripts/layout.js"></script>
<script src="/blog/js/wow.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script type="text/javascript">
    jQuery(document).ready(function() {
        Layout.init();    
        Layout.initOWL();
        Layout.initTwitter();
        Layout.initFixHeaderWithPreHeader(); /* Switch On Header Fixing (only if you have pre-header) */
        Layout.initNavScrolling(); 
	new WOW().init();
    });
</script>
<!-- END CORE PLUGINS -->

<!-- BEGIN PAGE-SPECIFIC PLUGINS --> 







<!-- END PAGE-SPECIFIC PLUGINS --> 

<!-- BEGIN INTEGRATIONS -->





<!-- END INTEGRATIONS -->

</body>
</html>
